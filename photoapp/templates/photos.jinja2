{% extends "layout.jinja2" %}
{% import "_pagination.jinja2" as pagination with context %}

{% block content %}

<div id="photo-modal" class="modal hide fade"></div>

<script type="text/template" id="photo-modal-template">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3><%= title %></h3>
    </div>
    <div class="modal-body">
        <p>
            <div class="photo-load-progress progress progress-striped active"><div class="bar" style="width:0%;"></div></div> 
            <a class="photo-image hide" target="_blank" href="<%= image_url %>">
                <img src="<%= thumbnail_url %>" height="<%= height %>" width="<%= width %>" alt="<%= title %>">
            </a>
        </p>
    </div>
    <div class="modal-footer">
        <a href="javascript:void(0);" class="btn delete-btn">Delete this photo</a>
        <a href="<%= send_url %>" class="btn">Send this photo</a>
        <a href="#" class="btn" data-dismiss="modal">Close</a>
    </div>
</script>



<button class="btn-large btn-block btn-primary" type="button" id="tags-btn">Tags</button>

<div class="well" id="tag-cloud" style="height:250px;"></div>

<ul class="thumbnails">
{% for photo in page.items %}
    <li class="span4 photo">
        <a data-send-url="{{ request.route_url('send', id=photo.id) }}" 
           data-image-url="{{ request.route_url('image', id=photo.id) }}"
           data-thumbnail-url="{{ request.route_url('thumbnail', id=photo.id) }}"
           data-photo-id="{{ photo.id }}"
           {% if has_permission('delete', photo) %}data-delete-url="{{ request.route_url('delete', id=photo.id) }}"{% endif %}
           data-width="{{ photo.width }}"
           data-height="{{ photo.height }}"
           data-title="{{ photo.title }}"
           href="#" class="thumbnail">
            <img src="{{ request.route_url('thumbnail', id=photo.id) }}" title="{{ photo.title }}" alt="{{ photo.title }}">
        </a>
    </li>
{% endfor %}
</ul>


{{ pagination.render_page_links(page) }}

{% endblock %}

{% block scripts %}
<script>
var tagList = [];

{% for tag in request.user.tags %}
tagList.push({
   text: '{{ tag.name }}',
   weight: {{ tag.frequency }},
   link: '{{ request.route_url('tag', id=tag.id, name=tag.name) }}'
});
{% endfor %}

new PhotoApp.PhotosPage(tagList);

</script>


{% endblock %}
