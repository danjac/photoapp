var PhotoApp;PhotoApp=PhotoApp||{},PhotoApp.Message=function(){function a(a){this.message=a}return a.prototype.show=function(){var a;return a='        <div class="alert alert-success">            <button type="button" class="close" data-dismiss="alert">&times;</button>            '+this.message+"        </div>",$("#messages").html(a)},a}(),PhotoApp.showMessage=function(a){return(new PhotoApp.Message(a)).show()},PhotoApp.Photo=function(){function a(a){var b=this;this.el=a,this.doc=$(document),this.modal=$("#photo-modal"),this.photoID=this.el.attr("data-photo-id"),this.imageURL=this.el.attr("data-image-url"),this.thumbURL=this.el.attr("data-thumbnail-url"),this.sendURL=this.el.attr("data-send-url"),this.deleteURL=this.el.attr("data-delete-url"),this.editURL=this.el.attr("data-edit-url"),this.title=this.el.attr("data-title"),this.height=this.el.attr("data-height"),this.width=this.el.attr("data-width"),this.tmpl=$("#photo-modal-template").html(),this.content=_.template(this.tmpl,{image_url:this.imageURL,thumbnail_url:this.thumbURL,title:this.title,height:this.height,width:this.width}),this.doc.on("click","#photo-modal .cancel-btn",function(a){return b.showDefaultContent()}),this.doc.on("submit","#send-photo-form",function(a){return b.submitForm($("#send-photo-form")),!1}),this.doc.on("submit","#edit-photo-form",function(c){return b.submitForm($("#edit-photo-form"),function(c){return a=$("[data-photo-id='"+b.photoID+"']"),a.attr("data-title",c.title),a.find("img").attr("title",c.title),$("#photo-modal h3").text(c.title)}),!1}),this.modal.on("show",function(){var a,c,d,e,f;return b.modal.html(b.content),b.editURL!=null?$("#photo-modal .edit-btn").show().on("click",function(){return b.edit()}):$("#photo-modal .edit-btn").hide(),b.deleteURL!=null?$("#photo-modal .delete-btn").show().on("click",function(){return b["delete"]()}):$("#photo-modal .delete-btn").hide(),$("#photo-modal .send-btn").on("click",function(){return b.send()}),d=$("#photo-modal .photo-load-progress .bar"),e=0,f=function(){if(e<100)return e+=5,d.width(e+"%")},c=setInterval(f,300),a=new Image,a.src=b.imageURL,a.onload=function(){return clearInterval(c),$("#photo-modal .photo-image").show(),$("#photo-modal .photo-load-progress").hide(),$("#photo-modal-footer").show()}}),this.modal.modal("show")}return a.prototype.submitForm=function(a,b){var c=this;return $.post(a.attr("action"),a.serialize(),function(a){if(!a.success)return $("#photo-modal-load").html(a.html);a.message!=null&&PhotoApp.showMessage(a.message),c.showDefaultContent();if(b!=null)return b(a)}),!1},a.prototype.showDefaultContent=function(){return $("#photo-modal-load").hide(),$("#photo-modal-content").show()},a.prototype.showForm=function(a){var b=this;return $("#photo-modal-content").hide(),$.get(a,null,function(a){return $("#photo-modal-load").show().html(a.html)}),!1},a.prototype["delete"]=function(){var a=this;return confirm("Are you sure you want to delete this photo?")&&(this.modal.modal("hide"),$.post(this.deleteURL,null,function(b){if(b.success!=null)return a.el.parent().remove(),PhotoApp.showMessage("Photo '"+a.title+"' has been deleted")})),!1},a.prototype.send=function(){return this.showForm(this.sendURL)},a.prototype.edit=function(){return this.showForm(this.editURL)},a}(),PhotoApp.PhotosPage=function(){function a(a){var b=this;this.tagList=a,jQuery(function(){return b.onload()})}return a.prototype.onload=function(){var a=this;return this.doc=$(document),this.tagList!=null&&(this.tagCloud=$("#tag-cloud"),this.tagCloud.jQCloud(this.tagList),this.tagCloud.hide()),this.tagBtn=$("#tags-btn"),this.tagList==null&&this.tagBtn.remove(),this.doc.on("click",".thumbnails a",function(a){return new PhotoApp.Photo($(this))}),this.doc.on("click","#tags-btn",function(b){var c;return a.tagCloud.slideToggle("slow"),a.tagBtn.toggleClass("btn-primary"),c=a.tagBtn.find("i"),c.toggleClass("icon-white"),!1}),$.ias({container:".thumbnails",item:".photo",pagination:".pagination",next:".next a",loader:'<img src="ias/loader.gif">'})},a}();