var PhotoApp;if(typeof PhotoApp=="undefined"||PhotoApp===null)PhotoApp={};PhotoApp.Message=function(){function a(a,b){this.message=a,this.target=b!=null?b:"#messages"}return a.prototype.show=function(){var a;return a='        <div class="alert alert-success">            <button type="button" class="close" data-dismiss="alert">&times;</button>            '+this.message+"        </div>",$(this.target).html(a).show()},a}(),PhotoApp.showMessage=function(a,b){return(new PhotoApp.Message(a,b)).show()},PhotoApp.paginate=function(){return $.ias({container:".thumbnails",item:".photo",pagination:".pagination",next:".next a",loader:'<img src="ias/loader.gif">'})},PhotoApp.Photo=function(){function a(a,b){var c=this;this.page=a,this.el=b,this.doc=this.page.doc,this.modal=$("#photo-modal"),this.photoID=this.el.attr("data-photo-id"),this.imageURL=this.el.attr("data-image-url"),this.thumbnailURL=this.el.attr("data-thumbnail-url"),this.downloadURL=this.el.attr("data-download-url"),this.deleteURL=this.el.attr("data-delete-url"),this.deleteSharedURL=this.el.attr("data-delete-shared-url"),this.editURL=this.el.attr("data-edit-url"),this.shareURL=this.el.attr("data-share-url"),this.copyURL=this.el.attr("data-copy-url"),this.owner=this.el.attr("data-owner"),this.title=this.el.attr("data-title"),this.height=this.el.attr("data-height"),this.width=this.el.attr("data-width"),this.tmpl=$("#photo-modal-template").html(),this.render(),this.doc.off("submit","#edit-photo-form"),this.doc.off("submit","#copy-photo-form"),this.doc.off("submit","#share-photo-form"),this.doc.off("click","#photo-modal .share-add-another-btn"),this.doc.off("click","#photo-modal .remove-share-email"),this.doc.off("click","#photo-modal .cancel-btn"),this.doc.off("click","#photo-modal .edit-btn"),this.doc.off("click","#photo-modal .share-btn"),this.doc.off("click","#photo-modal .copy-btn"),this.doc.off("click","#photo-modal .delete-btn"),this.doc.off("click","#photo-modal .delete-shared-btn"),this.doc.on("click","#photo-modal .share-add-another-btn",function(a){var b,c;return a.preventDefault(),c=$("#share-photo-form input[type='text']").length,b='<dd><input type="text" name="emails-'+c+'">                <a href="#" class="remove-share-email"><i class="icon-remove"></i></a>                </dd>',$(a.currentTarget).parent().before(b)}),this.doc.on("click","#photo-modal .remove-share-email",function(a){return a.preventDefault(),$(a.currentTarget).parent().remove()}),this.doc.on("click","#photo-modal .cancel-btn",function(a){return a.preventDefault(),c.showDefaultContent()}),this.doc.on("submit","#share-photo-form",function(a){return a.preventDefault(),c.submitForm($("#share-photo-form"))}),this.doc.on("submit","#copy-photo-form",function(a){return a.preventDefault(),c.modal.modal("hide"),c.submitForm($("#copy-photo-form"),function(a){if(a.success!=null)return c.el.parent().remove(),c.showMessage(a.message)})}),this.doc.on("submit","#edit-photo-form",function(a){return a.preventDefault(),c.submitForm($("#edit-photo-form"),function(a){var b;return c.title=a.title,alert(c.el.attr("data-title")),c.el.attr("data-title",c.title),b=c.el.find("img"),b.attr("alt",c.title),b.attr("title",c.title),c.modal.find("h3").text(c.title),c.modal.modal("show")})}),this.editURL!=null?$("#photo-modal .edit-btn").show().on("click",function(){return c.edit()}):$("#photo-modal .edit-btn").hide(),this.shareURL!=null?$("#photo-modal .share-btn").show().on("click",function(){return c.share()}):$("#photo-modal .share-btn").hide(),this.copyURL!=null?$("#photo-modal .copy-btn").show().on("click",function(){return c.copy()}):$("#photo-modal .copy-btn").hide(),this.deleteURL!=null?$("#photo-modal .delete-btn").show().on("click",function(){return c["delete"]()}):$("#photo-modal .delete-btn").hide(),this.deleteSharedURL!=null?$("#photo-modal .delete-shared-btn").show().on("click",function(){return c.deleteShared()}):$("#photo-modal .delete-shared-btn").hide(),this.modal.on("show",function(){var a,b,d,e,f;return d=$("#photo-modal .photo-load-progress .bar"),e=0,f=function(){if(e<100)return e+=5,d.width(e+"%")},b=setInterval(f,300),a=new Image,a.src=c.thumbnailURL,a.onload=function(){return clearInterval(b),$("#photo-modal .photo-image").show(),$("#photo-modal .photo-load-progress").hide(),$("#photo-modal-footer").show()}}),this.modal.modal("show")}return a.prototype.render=function(){return this.modal.html(_.template(this.tmpl,this))},a.prototype.showMessage=function(a){return PhotoApp.showMessage(a,"#photo-modal .messages")},a.prototype.submitForm=function(a,b){var c=this;return $.post(a.attr("action"),a.serialize(),function(a){if(!a.success)return $("#photo-modal-load").html(a.html);a.message!=null&&c.showMessage(a.message),c.showDefaultContent();if(b!=null)return b(a)})},a.prototype.showDefaultContent=function(){return $("#photo-modal-load").hide(),$("#photo-modal-content").show(),$("#photo-modal-footer .buttons").show()},a.prototype.showForm=function(a){var b=this;return $("#photo-modal-content").hide(),$("#photo-modal-footer .buttons").hide(),$.get(a,null,function(a){return $("#photo-modal-load").show().html(a.html)})},a.prototype["delete"]=function(){var a=this;if(confirm("Are you sure you want to delete this photo?"))return this.modal.modal("hide"),$.post(this.deleteURL,null,function(b){if(b.success!=null)return a.el.parent().remove(),PhotoApp.showMessage("Photo '"+a.title+"' has been deleted")})},a.prototype.edit=function(){return this.showForm(this.editURL)},a.prototype.share=function(){return this.showForm(this.shareURL)},a.prototype.copy=function(){return this.showForm(this.copyURL)},a.prototype.deleteShared=function(){var a=this;if(confirm("Are you sure you want to delete this photo?"))return this.modal.modal("hide"),$.post(this.deleteSharedURL,null,function(b){if(b.success!=null)return a.el.parent().remove(),PhotoApp.showMessage("Photo '"+a.title+"' has been deleted")})},a}(),PhotoApp.SharedPage=function(){function a(){var a=this;jQuery(function(){return a.onload()})}return a.prototype.onload=function(){return PhotoApp.paginate()},a}(),PhotoApp.UploadPage=function(){function a(){var a=this;jQuery(function(){return a.onload()})}return a.prototype.onload=function(){var a,b=this;return this.doc=$(document),a=3,$(".upload-add-another-btn").click(function(b){var c,d,e;b.preventDefault(),c=$(b.currentTarget),e=$("form input[type='file']").length;if(e<a){d='<dd><input type="file" name="images-'+e+'">                    <a href="#" class="remove-upload-field"><i class="icon-remove"></i></a>                    </dd>',c.parent().before(d);if(e+1>=a)return c.parent().hide()}}),this.doc.on("click",".remove-upload-field",function(b){var c;b.preventDefault(),$(b.currentTarget).parent().remove(),c=$("form input[type='file']").length;if(c<a)return $(".upload-add-another-btn").parent().show()})},a}(),PhotoApp.PhotosPage=function(){function a(a){var b=this;this.tagsURL=a,jQuery(function(){return b.onload()})}return a.prototype.loadTags=function(){var a=this;return $("#tag-cloud").remove(),$.get(this.tagsURL,null,function(b){var c;if(b.tags.length>0)return c='<div class="well" id="tag-cloud" style="height:250px;"></div>',a.searchBox.append(c),$("#tag-cloud").jQCloud(b.tags)})},a.prototype.onload=function(){var a=this;return this.doc=$(document),this.searchBox=$("#search-box"),this.searchBox.hide(),this.searchBtn=$("#search-btn"),this.doc.on("click","a.thumbnail",function(b){return new PhotoApp.Photo(a,$(b.currentTarget))}),this.doc.on("click","#search-btn",function(b){var c;return a.searchBox.slideToggle("slow"),a.searchBtn.toggleClass("btn-primary"),c=a.searchBtn.find("i"),c.toggleClass("icon-white"),a.searchBtn.is(".btn-primary")||a.loadTags(),!1}),PhotoApp.paginate()},a}();