/*!
 * Infinite Ajax Scroll, a jQuery plugin
 * Version v0.1.6
 * http://webcreate.nl/
 *
 * Copyright (c) 2011-2012 Jeroen Fiege
 * Licensed under the MIT License:
 * http://webcreate.nl/license
 */(function(a){function b(a){window.console&&window.console.log&&window.console.log(a)}a.ias=function(b){function h(){return e.onChangePage(function(a,b,d){f&&f.setPage(a,d),c.onPageChange.call(this,a,d,b)}),i(),f&&f.havePage()&&(k(),pageNum=f.getPage(),d.forceScrollTop(function(){pageNum>1?(p(pageNum),curTreshold=m(!0),a("html,body").scrollTop(curTreshold)):i()})),g}function i(){l(),c.scrollContainer.scroll(j)}function j(){c.scrollContainer==a.ias.defaults.scrollContainer?scrTop=c.scrollContainer.scrollTop():scrTop=c.scrollContainer.offset().top,wndHeight=c.scrollContainer.height(),curScrOffset=scrTop+wndHeight,curScrOffset>=m()&&n(curScrOffset)}function k(){c.scrollContainer.unbind("scroll",j)}function l(){a(c.pagination).hide()}function m(b){return el=a(c.container).find(c.item).last(),el.size()==0?0:(treshold=el.offset().top+el.height(),b||(treshold+=c.tresholdMargin),treshold)}function n(b,d){urlNextPage=a(c.next).attr("href");if(!urlNextPage)return k();if(c.beforePageChange&&a.isFunction(c.beforePageChange)&&c.beforePageChange(b,urlNextPage)===!1)return;e.pushPages(b,urlNextPage),k(),r(),o(urlNextPage,function(b,e){result=c.onLoadItems.call(this,e),result!==!1&&(a(e).hide(),curLastItem=a(c.container).find(c.item).last(),curLastItem.after(e),a(e).fadeIn()),a(c.pagination).replaceWith(a(c.pagination,b)),s(),i(),c.onRenderComplete.call(this,e),d&&d.call(this)})}function o(b,d){var e=[];a.get(b,null,function(b){container=a(c.container,b).eq(0),0==container.length&&(container=a(b).filter(c.container).eq(0)),container&&container.find(c.item).each(function(){e.push(this)}),d&&d.call(this,b,e)},"html")}function p(b){curTreshold=m(!0),curTreshold>0&&n(curTreshold,function(){k(),e.getCurPageNum(curTreshold)+1<b?(p(b),a("html,body").animate({scrollTop:curTreshold},400,"swing")):(a("html,body").animate({scrollTop:curTreshold},1e3,"swing"),i())})}function q(){return loader=a(".ias_loader"),loader.size()==0&&(loader=a("<div class='ias_loader'>"+c.loader+"</div>"),loader.hide()),loader}function r(){loader=q(),c.customLoaderProc!==!1?c.customLoaderProc(loader):(el=a(c.container).find(c.item).last(),el.after(loader),loader.fadeIn())}function s(){loader=q(),loader.remove()}var c=a.extend({},a.ias.defaults,b),d=new a.ias.util,e=new a.ias.paging(c.scrollContainer),f=c.history?new a.ias.history:!1,g=this;h()},a.ias.defaults={container:"#container",scrollContainer:a(window),item:".item",pagination:"#pagination",next:".next",loader:'<img src="images/loader.gif"/>',tresholdMargin:0,history:!0,onPageChange:function(){},beforePageChange:function(){},onLoadItems:function(){},onRenderComplete:function(){},customLoaderProc:!1},a.ias.util=function(){function e(){a(window).load(function(){b=!0})}var b=!1,c=!1,d=this;e(),this.forceScrollTop=function(e){a("html,body").scrollTop(0),c||(b?(e.call(),c=!0):setTimeout(function(){d.forceScrollTop(e)},1))}},a.ias.paging=function(){function e(){a(window).scroll(f)}function f(){scrTop=a(window).scrollTop(),wndHeight=a(window).height(),curScrOffset=scrTop+wndHeight,curPageNum=g(curScrOffset),curPagebreak=h(curScrOffset),d!=curPageNum&&c.call(this,curPageNum,curPagebreak[0],curPagebreak[1]),d=curPageNum}function g(a){for(i=b.length-1;i>0;i--)if(a>b[i][0])return i+1;return 1}function h(a){for(i=b.length-1;i>=0;i--)if(a>b[i][0])return b[i];return null}var b=[[0,document.location.toString()]],c=function(){},d=1;e(),this.getCurPageNum=function(a){return g(a)},this.onChangePage=function(a){c=a},this.pushPages=function(a,c){b.push([a,c])}},a.ias.history=function(){function c(){b=!!(window.history&&history.pushState&&history.replaceState),b=!1}var a=!1,b=!1;c(),this.setPage=function(a,b){this.updateState({page:a},"",b)},this.havePage=function(){return this.getState()!=0},this.getPage=function(){return this.havePage()?(stateObj=this.getState(),stateObj.page):1},this.getState=function(){if(b){stateObj=history.state;if(stateObj&&stateObj.ias)return stateObj.ias}else{haveState=window.location.hash.substring(0,7)=="#/page/";if(haveState)return pageNum=parseInt(window.location.hash.replace("#/page/","")),{page:pageNum}}return!1},this.updateState=function(b,c,d){a?this.replaceState(b,c,d):this.pushState(b,c,d)},this.pushState=function(c,d,e){b?history.pushState({ias:c},d,e):(hash=c.page>0?"#/page/"+c.page:"",window.location.hash=hash),a=!0},this.replaceState=function(a,c,d){b?history.replaceState({ias:a},c,d):this.pushState(a,c,d)}}})(jQuery);